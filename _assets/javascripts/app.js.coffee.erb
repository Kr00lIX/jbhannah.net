#= require foundation/foundation
#= require_directory ./foundation
#= require vendor/jquery.ba-hashchange.js
#= require vendor/jquery.swiftype.search.js
#= require vendor/harvest.js

$(document).foundation()

$ ->
  $("a[href^=http]").each (index, element) ->
    if @href.indexOf("http://" + location.hostname) is -1
      rel = $(element).attr "rel"
      unless rel is `undefined`
        rel += " "
      else
        rel = ""
      $(element).attr "rel", rel + "external"

  $("a[rel~=external]").attr("target", "_blank")
<% unless site.config['dev'] == true %>
    .click =>
      _gaq.push ["_trackEvent", "Outbound Links", @href, @text]
<% end %>

  $("a[href=#search]").on 'click', (event) =>
    event.preventDefault()

    $("#st-search-input").swiftypeSearch
      resultContainingElement: "#st-results-container"
      engineKey: "ijn1crr9z7TnpjnNMiS1"

    $("#st-results-container").show()
    $("#site-menu").hide 0, ->
      $("#search").fadeIn 200

    $("a[href=#site-menu]").on 'click', (event) =>
      event.preventDefault()

      $("#st-results-container").hide()
      $("#search").hide 0, ->
        $("#site-menu").fadeIn 200

((d, s, id) ->
  js = undefined
  fjs = d.getElementsByTagName(s)[0]
  unless d.getElementById(id)
    js = d.createElement(s)
    js.id = id
    js.src = "https://platform.twitter.com/widgets.js"
    fjs.parentNode.insertBefore js, fjs
) document, "script", "twitter-wjs"

((d, s, id) ->
  js = undefined
  fjs = d.getElementsByTagName(s)[0]
  return  if d.getElementById(id)
  js = d.createElement(s)
  js.id = id
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1"
  fjs.parentNode.insertBefore js, fjs
) document, "script", "facebook-jssdk"

(->
  po = document.createElement("script")
  po.type = "text/javascript"
  po.async = true
  po.src = "https://apis.google.com/js/plusone.js"
  s = document.getElementsByTagName("script")[0]
  s.parentNode.insertBefore po, s
)()
